# üîî –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Push-—É–≤–µ–¥–æ–º–ª–µ–Ω—å (FCM)

## –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### 1. –û—Ç—Ä–∏–º–∞—Ç–∏ VAPID –∫–ª—é—á –∑ Firebase Console

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ [Firebase Console](https://console.firebase.google.com/)
2. –í–∏–±–µ—Ä—ñ—Ç—å –≤–∞—à –ø—Ä–æ–µ–∫—Ç (**dreamshop-odessa**)
3. –ü–µ—Ä–µ–π–¥—ñ—Ç—å: **Project Settings** (‚öôÔ∏è –∑–Ω–∞—á–æ–∫) ‚Üí **Cloud Messaging**
4. –ü—Ä–æ–∫—Ä—É—Ç—ñ—Ç—å –¥–æ —Å–µ–∫—Ü—ñ—ó **Web Push certificates**
5. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **Generate key pair**
6. –°–∫–æ–ø—ñ—é–π—Ç–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∫–ª—é—á (—Ñ–æ—Ä–º–∞—Ç: `BPxxxxx...`)

### 2. –î–æ–¥–∞—Ç–∏ VAPID –∫–ª—é—á —É .env —Ñ–∞–π–ª

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É (—è–∫—â–æ –π–æ–≥–æ –Ω–µ–º–∞—î):

```bash
# –°–∫–æ–ø—ñ—é–π—Ç–µ –∑ env.example
cp env.example .env
```

–í—ñ–¥–∫—Ä–∏–π—Ç–µ `.env` —ñ –¥–æ–¥–∞–π—Ç–µ VAPID –∫–ª—é—á:

```env
REACT_APP_FIREBASE_VAPID_KEY=–≤–∞—à_vapid_–∫–ª—é—á_—Ç—É—Ç
```

**–í–∞–∂–ª–∏–≤–æ:** –ø—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è `.env` –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å dev-—Å–µ—Ä–≤–µ—Ä:
```bash
npm start
```

### 3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–æ–±–æ—Ç—É

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ —Å–∞–π—Ç —É –±—Ä–∞—É–∑–µ—Ä—ñ (HTTPS –∞–±–æ localhost)
2. –£–≤—ñ–π–¥—ñ—Ç—å –≤ –∞–∫–∞—É–Ω—Ç
3. –£ **–ü—Ä–æ—Ñ—ñ–ª—ñ** –∞–±–æ **–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ** –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å **"–£–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è"**
4. –î–æ–∑–≤–æ–ª—å—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–Ω—è —É —Å–ø–ª–∏–≤–∞—é—á–æ–º—É –≤—ñ–∫–Ω—ñ –±—Ä–∞—É–∑–µ—Ä–∞
5. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ ‚Äî –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—è `‚úÖ FCM Token: ...`

---

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### –ö–ª—ñ—î–Ω—Ç—Å—å–∫–∞ —á–∞—Å—Ç–∏–Ω–∞ (–≥–æ—Ç–æ–≤–æ ‚úÖ)

- **src/firebase/messaging.ts** ‚Äî –∑–∞–ø–∏—Ç –¥–æ–∑–≤–æ–ª—É, –æ—Ç—Ä–∏–º–∞–Ω–Ω—è FCM —Ç–æ–∫–µ–Ω–∞, –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ Firestore
- **public/firebase-messaging-sw.js** ‚Äî Service Worker –¥–ª—è —Ñ–æ–Ω–æ–≤–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω—å
- **src/utils/notificationUtils.ts** ‚Äî —É—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ –∞–¥–º—ñ–Ω—ñ–≤/–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- **src/pages/AdminPanel.tsx** ‚Äî –∫–Ω–æ–ø–∫–∞ –≤–∫–ª—é—á–µ–Ω–Ω—è —É–≤–µ–¥–æ–º–ª–µ–Ω—å –¥–ª—è –∞–¥–º—ñ–Ω–∞
- **src/pages/Profile.tsx** ‚Äî –∫–Ω–æ–ø–∫–∞ –≤–∫–ª—é—á–µ–Ω–Ω—è —É–≤–µ–¥–æ–º–ª–µ–Ω—å –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

### –°–µ—Ä–≤–µ—Ä–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ (–ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ ‚ö†Ô∏è)

–î–ª—è —Ä–µ–∞–ª—å–Ω–æ—ó –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω—å –ø–æ—Ç—Ä—ñ–±–µ–Ω **—Å–µ—Ä–≤–µ—Ä** –∞–±–æ **Firebase Cloud Functions**.

–ó–∞—Ä–∞–∑ `sendNotificationToAdmins` —ñ `sendNotificationToUser` —É `notificationUtils.ts` –ª–∏—à–µ **–ª–æ–≥—É—é—Ç—å** –∑–∞–ø–∏—Ç–∏, –∞–ª–µ –Ω–µ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å —Ä–µ–∞–ª—å–Ω—ñ –ø—É—à—ñ.

**–î–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏:**

#### –í–∞—Ä—ñ–∞–Ω—Ç 1: Firebase Cloud Functions (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Firebase CLI:
   ```bash
   npm install -g firebase-tools
   firebase login
   firebase init functions
   ```

2. –£ `functions/src/index.ts` –¥–æ–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü—ñ—é –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:
   ```typescript
   import * as admin from 'firebase-admin';
   admin.initializeApp();

   export const sendNotification = functions.https.onCall(async (data, context) => {
     const { tokens, title, body, clickAction, data: customData } = data;

     const message = {
       notification: { title, body },
       data: customData,
       webpush: {
         fcmOptions: { link: clickAction }
       }
     };

     await admin.messaging().sendMulticast({
       tokens,
       ...message
     });
   });
   ```

3. –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ:
   ```bash
   firebase deploy --only functions
   ```

4. –£ `notificationUtils.ts` –∑–∞–º—ñ–Ω—ñ—Ç—å `console.log` –Ω–∞ –≤–∏–∫–ª–∏–∫ Cloud Function —á–µ—Ä–µ–∑ `httpsCallable`.

#### –í–∞—Ä—ñ–∞–Ω—Ç 2: –í–ª–∞—Å–Ω–∏–π Node.js —Å–µ—Ä–≤–µ—Ä

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Firebase Admin SDK –∑ –≤–∞—à–æ–≥–æ –±–µ–∫–µ–Ω–¥–∞ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å.

---

## –¢—Ä–∏–≥–µ—Ä–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω—å

### –î–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤

**–ö–æ–ª–∏:** –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è  
**–î–µ:** `src/firebase/services.ts` ‚Üí `orderService.create()`  
**–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:** `üõí –ù–æ–≤–∏–π –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è! –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #xxxxx –Ω–∞ —Å—É–º—É YYYY ‚Ç¥`

### –î–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

**–ö–æ–ª–∏:** –ó–º—ñ–Ω–∞ —Å—Ç–∞—Ç—É—Å—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è  
**–î–µ:** `src/firebase/services.ts` ‚Üí `orderService.updateStatus()`  
**–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:** `üì¶ –°—Ç–∞—Ç—É—Å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞ "–ù–û–í–ò–ô_–°–¢–ê–¢–£–°"`

---

## Troubleshooting

### "VAPID –∫–ª—é—á –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ"
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å `REACT_APP_FIREBASE_VAPID_KEY` —É `.env`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å `npm start` –ø—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è `.env`

### "Permission denied" —É –±—Ä–∞—É–∑–µ—Ä—ñ
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥—Ö–∏–ª–∏–≤ –¥–æ–∑–≤—ñ–ª ‚Äî –ø–æ–ø—Ä–æ—Å—ñ—Ç—å –≤—Ä—É—á–Ω—É –≤–≤—ñ–º–∫–Ω—É—Ç–∏ —É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è —Å–∞–π—Ç—É

### –£–≤–µ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç—å
- **–Ø–∫—â–æ –≤ –∫–æ–Ω—Å–æ–ª—ñ –ø–æ–º–∏–ª–∫–∞ "not implemented"** ‚Äî –ø–æ—Ç—Ä—ñ–±–µ–Ω —Å–µ—Ä–≤–µ—Ä–Ω–∏–π –±–µ–∫–µ–Ω–¥ (Cloud Function)
- **–Ø–∫—â–æ —Ç–æ–∫–µ–Ω –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è** ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ Firestore –¥–ª—è –∫–æ–ª–µ–∫—Ü—ñ—ó `users`

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ iOS
- Safari iOS –≤–∏–º–∞–≥–∞—î **–¥–æ–¥–∞–≤–∞–Ω–Ω—è —Å–∞–π—Ç—É –Ω–∞ –¥–æ–º–∞—à–Ω—ñ–π –µ–∫—Ä–∞–Ω** (Add to Home Screen) –¥–ª—è —Ä–æ–±–æ—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω—å
- Push –Ω–∞ iOS –ø—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –∑ PWA, –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ–≥–æ —á–µ—Ä–µ–∑ Safari

---

## Firestore –ø—Ä–∞–≤–∏–ª–∞

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏ –º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–æ —á–∏—Ç–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤:

```javascript
match /users/{userId} {
  allow read: if request.auth != null;
  allow write: if request.auth.uid == userId;
}
```

---

## –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –±—Ä–∞—É–∑–µ—Ä—ñ–≤

| –ë—Ä–∞—É–∑–µ—Ä       | –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ |
|---------------|-----------|
| Chrome        | ‚úÖ –¢–∞–∫    |
| Firefox       | ‚úÖ –¢–∞–∫    |
| Edge          | ‚úÖ –¢–∞–∫    |
| Safari macOS  | ‚úÖ –¢–∞–∫ (16.4+) |
| Safari iOS    | ‚ö†Ô∏è –¢—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ PWA |
| Opera         | ‚úÖ –¢–∞–∫    |

---

## –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–µ—Å—É—Ä—Å–∏

- [Firebase Cloud Messaging (FCM) ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è](https://firebase.google.com/docs/cloud-messaging)
- [Web Push Notifications ‚Äî MDN](https://developer.mozilla.org/en-US/docs/Web/API/Push_API)
- [Service Workers ‚Äî Web.dev](https://web.dev/service-workers/)
