<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–Ü–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä—ñ–≤ DreamShop</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .button {
            background: linear-gradient(135deg, #4dd0e1 0%, #26c6da 50%, #00acc1 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 10px 10px 10px 0;
            transition: transform 0.2s;
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        .button.danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 50%, #c44569 100%);
        }
        #log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .log-entry.success { color: #27ae60; }
        .log-entry.error { color: #e74c3c; }
        .log-entry.info { color: #3498db; }
        .log-entry.warning { color: #f39c12; }
        .stats {
            background: #ecf0f1;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .stat {
            background: white;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
        }
        .stat-label {
            color: #7f8c8d;
            font-size: 12px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõí –Ü–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä—ñ–≤ DreamShop</h1>
        <p class="subtitle">–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –±–∞–∑–æ–≤—ñ —Ç–æ–≤–∞—Ä–∏ –∑ JSON —Ñ–∞–π–ª—ñ–≤ –ø—Ä—è–º–æ —É Firestore</p>
        
        <div>
            <button class="button" onclick="importBasicProducts()">üì• –Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –±–∞–∑–æ–≤—ñ —Ç–æ–≤–∞—Ä–∏</button>
            <button class="button" onclick="importSpicerProducts()">üç∑ –Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ Sp√≠cer —Ç–æ–≤–∞—Ä–∏</button>
            <button class="button" onclick="checkProducts()">üîç –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ç–æ–≤–∞—Ä–∏ –≤ –±–∞–∑—ñ</button>
            <button class="button danger" onclick="clearAllProducts()">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏ –í–°–Ü —Ç–æ–≤–∞—Ä–∏</button>
        </div>

        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="totalCount">0</div>
                <div class="stat-label">–£—Å—å–æ–≥–æ —Ç–æ–≤–∞—Ä—ñ–≤</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="basicCount">0</div>
                <div class="stat-label">–ë–∞–∑–æ–≤—ñ —Ç–æ–≤–∞—Ä–∏</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="spicerCount">0</div>
                <div class="stat-label">Sp√≠cer —Ç–æ–≤–∞—Ä–∏</div>
            </div>
        </div>

        <div id="log"></div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getFirestore, 
            collection, 
            getDocs, 
            addDoc, 
            deleteDoc,
            query,
            where,
            writeBatch
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBPZW-u_JwGg3j6qY3-Pib_YfhFq5WlHf4",
            authDomain: "dreamshop-odessa.firebaseapp.com",
            projectId: "dreamshop-odessa",
            storageBucket: "dreamshop-odessa.appspot.com",
            messagingSenderId: "1094584929865",
            appId: "1:1094584929865:web:78236e88098f5aae12c905"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        window.checkProducts = async function() {
            log('üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—é —Ç–æ–≤–∞—Ä–∏ –≤ –±–∞–∑—ñ...', 'info');
            try {
                const snapshot = await getDocs(collection(db, 'products'));
                log(`‚úÖ –£—Å—å–æ–≥–æ —Ç–æ–≤–∞—Ä—ñ–≤: ${snapshot.size}`, 'success');
                
                const basicProducts = [];
                const spicerProducts = [];
                
                snapshot.forEach(doc => {
                    const product = doc.data();
                    if (product.brand === 'spicer') {
                        spicerProducts.push(product);
                    } else {
                        basicProducts.push(product);
                    }
                });
                
                log(`üì¶ –ë–∞–∑–æ–≤—ñ —Ç–æ–≤–∞—Ä–∏: ${basicProducts.length}`, 'info');
                log(`üç∑ Sp√≠cer —Ç–æ–≤–∞—Ä–∏: ${spicerProducts.length}`, 'info');
                
                document.getElementById('totalCount').textContent = snapshot.size;
                document.getElementById('basicCount').textContent = basicProducts.length;
                document.getElementById('spicerCount').textContent = spicerProducts.length;
                
                if (basicProducts.length > 0) {
                    log('üìù –ü–µ—Ä—à—ñ –±–∞–∑–æ–≤—ñ —Ç–æ–≤–∞—Ä–∏:', 'info');
                    basicProducts.slice(0, 3).forEach(p => {
                        log(`  - ${p.name} (–∫–∞—Ç–µ–≥–æ—Ä—ñ—è: ${p.category})`, 'info');
                    });
                }
                
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
            }
        };

        window.importBasicProducts = async function() {
            log('üì• –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –±–∞–∑–æ–≤—ñ —Ç–æ–≤–∞—Ä–∏...', 'info');
            try {
                const response = await fetch('/data/basic-products.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const products = await response.json();
                log(`‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –∑ —Ñ–∞–π–ª—É: ${products.length} —Ç–æ–≤–∞—Ä—ñ–≤`, 'success');
                
                let imported = 0;
                let skipped = 0;
                
                for (const product of products) {
                    try {
                        const existingQuery = query(
                            collection(db, 'products'),
                            where('name', '==', product.name)
                        );
                        const existingSnapshot = await getDocs(existingQuery);
                        
                        if (existingSnapshot.empty) {
                            const productData = {
                                ...product,
                                createdAt: new Date(),
                                updatedAt: new Date()
                            };
                            await addDoc(collection(db, 'products'), productData);
                            imported++;
                            log(`‚úÖ –î–æ–¥–∞–Ω–æ: ${product.name}`, 'success');
                        } else {
                            skipped++;
                            log(`‚è≠Ô∏è –í–∂–µ —ñ—Å–Ω—É—î: ${product.name}`, 'warning');
                        }
                    } catch (error) {
                        log(`‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ ${product.name}: ${error.message}`, 'error');
                    }
                }
                
                log(`‚ú® –Ü–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –î–æ–¥–∞–Ω–æ: ${imported}, –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${skipped}`, 'success');
                setTimeout(() => window.checkProducts(), 1000);
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É: ${error.message}`, 'error');
            }
        };

        window.importSpicerProducts = async function() {
            log('üì• –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ Sp√≠cer —Ç–æ–≤–∞—Ä–∏...', 'info');
            try {
                const response = await fetch('/data/firebase-products.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status} - –§–∞–π–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ`);
                }
                const products = await response.json();
                log(`‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –∑ —Ñ–∞–π–ª—É: ${products.length} —Ç–æ–≤–∞—Ä—ñ–≤`, 'success');
                
                let imported = 0;
                let skipped = 0;
                
                for (const product of products) {
                    try {
                        const existingQuery = query(
                            collection(db, 'products'),
                            where('name', '==', product.name || product.title)
                        );
                        const existingSnapshot = await getDocs(existingQuery);
                        
                        if (existingSnapshot.empty) {
                            const productData = {
                                name: product.name || product.title,
                                description: product.description || '',
                                price: parseFloat(product.price) || 0,
                                image: product.imageUrl || '',
                                images: product.imageUrl ? [product.imageUrl] : [],
                                category: product.category || 'chips',
                                subcategory: product.subcategory || '',
                                organic: false,
                                inStock: true,
                                isActive: true,
                                isPopular: false,
                                weight: product.volume || '',
                                ingredients: product.ingredients ? [product.ingredients] : [],
                                brand: 'spicer',
                                createdAt: new Date(),
                                updatedAt: new Date()
                            };
                            await addDoc(collection(db, 'products'), productData);
                            imported++;
                        } else {
                            skipped++;
                        }
                    } catch (error) {
                        log(`‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ: ${error.message}`, 'error');
                    }
                }
                
                log(`‚ú® –Ü–º–ø–æ—Ä—Ç Sp√≠cer —Ç–æ–≤–∞—Ä—ñ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –î–æ–¥–∞–Ω–æ: ${imported}, –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${skipped}`, 'success');
                setTimeout(() => window.checkProducts(), 1000);
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
            }
        };

        window.clearAllProducts = async function() {
            if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –í–ò–î–ê–õ–ò–¢–ò –í–°–Ü —Ç–æ–≤–∞—Ä–∏? –¶–µ –¥—ñ–π—Å—Ç–≤–æ –Ω–µ –º–æ–∂–Ω–∞ —Å–∫–∞—Å—É–≤–∞—Ç–∏!')) {
                return;
            }
            
            log('üóëÔ∏è –í–∏–¥–∞–ª—è—é –í–°–Ü —Ç–æ–≤–∞—Ä–∏...', 'warning');
            try {
                const snapshot = await getDocs(collection(db, 'products'));
                log(`–ó–Ω–∞–π–¥–µ–Ω–æ ${snapshot.size} —Ç–æ–≤–∞—Ä—ñ–≤ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è...`, 'info');
                
                const batch = writeBatch(db);
                let count = 0;
                
                snapshot.forEach(doc => {
                    batch.delete(doc.ref);
                    count++;
                });
                
                await batch.commit();
                log(`‚úÖ –í–∏–¥–∞–ª–µ–Ω–æ ${count} —Ç–æ–≤–∞—Ä—ñ–≤!`, 'success');
                
                setTimeout(() => window.checkProducts(), 1000);
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ: ${error.message}`, 'error');
            }
        };

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ç–æ–≤–∞—Ä–∏ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        window.checkProducts();
    </script>
</body>
</html>
